<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<!-- CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" rel="stylesheet">
	<style>

	@font-face {
		font-family: aquire;
		src: url(fonts/Aquire.otf);
	}

	nav{
		background-color: #141414;
		/*background-color: #21384e;*/
		/*background-color: #e74c3c;*/
	}

	.nav-link{
		font-family: montserrat;
		font-weight: 500;
	}
	body{
		color:#212529;
		background-color: #EEF0F2;
	}

	.imagesHolder{
		background-color:#0D21A1;
		color: #fff;
		padding-top:20px;
		padding-bottom:20px;
	}
	.quotesHolder{
		background-color:#011638;
		color: #fff;
		padding-top:20px;
		padding-bottom:20px;
	}
	.riddleHolder{
		background-color:#EEC643;
		color: #000;
		padding-top:20px;
		padding-bottom:20px;
	}

	.riddle{
		font-size:20px;
	}
	.adviceHolder{
		background-color:#0D21A1;
		color: #000;
		padding-top:20px;
		padding-bottom:20px;
	}
	footer{
		background-color: #141414;
		padding: 20px;
		color: #fff;
		text-align: center;
	}

	@keyframes moveright {
		0% {left:0px;}
		50% {left:5px;}
		100% {left:0px;}
	}
	@keyframes backgroundColorPalette {
		0% {
			color: #ee6055;
		}
		25% {
			color: #60d394;
		}
		50% {
			color: #aaf683;
		}
		75% {
			color: #ffd97d;
		}
		100% {
			color: #ff9b85;
		}
	}

	.flash{
		font-size: 20px;
		font-weight: bold;
		animation-name: backgroundColorPalette;
		animation-duration: 1s;
		animation-iteration-count: infinite;
		animation-direction: alternate;
		animation-timing-function: linear; 
	}
	.bounceRight{
		position: relative;
		animation-name: moveright;
		animation-duration: 1s;
		animation-iteration-count: infinite;
	}
	@keyframes moveleft {
		0% {right:0px;}
		50% {right:5px;}
		100% {right:0px;}
	}
	.bounceLeft{
		position: relative;
		animation-name: moveleft;
		animation-duration: 1s;
		animation-iteration-count: infinite;
	}
</style>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-dark p-0">
		<div class="container">
			<a class="navbar-brand" href="#" style="font-family: aquire; font-size:25px;">Styx</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item active" style="position: relative;">
						<a class="nav-link flash" href="https://discord.com/invite/NuDwUvE"><i class="fas fa-arrow-right bounceRight"></i> Join ATWD! <i class="fas fa-arrow-left bounceLeft"></i></a>
					</li>
					
				</ul></div>

			</div>
		</nav>
		<div class="text-center">
			<h1>About</h1>
			<div class="container">
				
				<p>Welcome to Styx's APIs. This page uses the Pixabay API, Quoutable API, Advice Slip API and some riddles stored in a JSON file. 4 API's with 5 functions. The first two blocks are used to generate an image and a quote from a fmaous person using keywords you input, the third combines the two and lets you download a custom inspirational image. The next block gives you a riddle and show's you the Answer, the text box is only there if you want to challenge yourself and actually try to answer them. And finally, the last block simply gives you some random Advice. I didn't compile any of these resources (the images, quotes, riddles or advice) so excuse any mistakes.</p>
			</div>

			<div class="imagesHolder">
				<div class="container">
					<div class="row" style="align-items: center;">
						<div class="col-sm-12 col-md-6 col-lg-6">
							<h4>Search term</h4>
							<p>What kind of image are you looking for?</p>
							<input type="text" class="form-control imageSearch mb-3">
							<p class="text-danger d-none errMsg">Something went wrong, Try another Keyword</p>
						</div>
						<div class="col-sm-12 col-md-6 col-lg-6" style="height:400px;">
							<img id="pixaImg" src="https://via.placeholder.com/400" alt="Image Not Loaded..." width="100%" style="max-height: 100%;">
							<!-- https://via.placeholder.com/400 -->
						</div>
					</div>
				</div>
			</div>
			<div class="quotesHolder">
				<div class="container">
					<div class="row" style="align-items: center;">
						<div class="col-sm-12 col-md-6 col-lg-6">
							<h4>Search term</h4>
							<p>What kind of quote are you looking for?</p>
							<input type="text" class="form-control quoteSearch">
							<input type="text" class="form-control customQuote mt-3" placeholder="Custom Quote">
							<input type="text" class="form-control customAuthor mt-3" placeholder="Custom Author">
						</div>
						<div class="col-sm-12 col-md-6 col-lg-6">
							<p class="qtPlace">This is where the quote will go</p><br><p class="author text-right"></p>
						</div>
					</div>
				</div>
			</div>
			<div class="combineHolder">
				<div class="container">
					<div class="row" style="align-items: center;">
						<div class="col-sm-12 col-md-12 col-lg-12 text-center">
							<button class="btn btn-primary combineBtn mt-3 mb-3">Combine Image and quote</button><br>
							<div style="max-width:800px;margin:0 auto;">
								<canvas style="border-radius: 10px;border: 2px solid black; width:100%;" id="canvas" width="800"></canvas><br>
							</div>
							<button class="btn btn-success downloadBtn mt-3 mb-3">Download Image</button><br>
						</div>
					</div>
				</div>
			</div>
			<div class="riddleHolder">
				<div class="container">
					<div class="row" style="align-items: center;">
						<div class="col-sm-12 col-md-12 col-lg-12 text-center">
							<div class="riddle"></div>
							<input type="text" class="form-control" placeholder="Answer here"><br>
							<div class="answer"></div>
							<button class="btn btn-danger seeAnswerBtn">See answer</button>
							<button class="btn btn-info newRiddleBtn">New Riddle</button>
						</div>
					</div>
				</div>
			</div>
			<div class="adviceHolder">
				<div class="container">
					<div class="row" style="align-items: center;">
						<div class="col-sm-12 col-md-12 col-lg-12 text-center">
							<button class="btn btn-success btn-lg adviceBtn">Give me some advice!</button>
							<p class="advice" style="margin-top: 10px; font-size: 20px; font-weight: bold; color:#fff;"></p>
						</div>
					</div>
				</div>
			</div>

			<footer>
				<h4>Thanks for visiting</h4>
				<p>Thanks to the <a href="https://pixabay.com/api/docs/">Pixabay API</a>, <a href="https://api.adviceslip.com">AdviceSlip API</a> and <a href="https://github.com/lukePeavey/quotable">Quotable API</a></p>
				<p>Thanks to "All things web development" for the challenge</p>
			</footer>


		</div>

		<!-- JS: move to bottom -->
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
		<script>
			$(".adviceBtn").on("click",function(){
				$.ajax({
					type: "GET",
					url: "https://api.adviceslip.com/advice",
					success: function(result) {
						if(JSON.parse(result).slip.advice == $(".advice").html()){
							$(".advice").addClass("text-danger").html("Cooldown...")
						}
						else{
							$(".advice").removeClass("text-danger").html(JSON.parse(result).slip.advice)
						}
					},
					error: function(result){
						console.log("Error: " + result.errorMessage);
					} 
				});				
			});

			$(".answer").hide();

			$(".seeAnswerBtn").on("click",function(){
				$(".answer").toggle();
				if ($(".answer").css("display") == "block"){
					$(this).html("Hide Answer");
				}
				else{
					$(this).html("Show Answer");
				}
			});
			$(".newRiddleBtn").on("click",function(){
				$(".answer").hide();
				var req = new XMLHttpRequest();
				req.open('GET', 'https://yusuf-117.github.io/apiUsage/riddlesReal.json', false);
				req.send(null);
				if(req.status == 200) {
					var riddles = req.responseText;
					// console.log(rnd);
					riddlesArray = riddles.split("|");
					var objArray = new Array();
					for (var i = 0; i < riddlesArray.length; i++) {
						objArray.push(JSON.parse(riddlesArray[i]));
					}
					rnd = Math.floor(Math.random() * objArray.length);


					$(".riddle").html(objArray[rnd].riddle);
					$(".answer").html(objArray[rnd].answer);
				}
			});
			$(".newRiddleBtn").trigger("click");


			$(".imageSearch").on("keyup",function(){
				var keyword = this.value;
				keyword = keyword.replace(" ", "+");
				$.ajax({
					type: "GET",
					url: "https://pixabay.com/api/?key=22374336-f544c10298c5719990869d8fd",
					data: {q: keyword},
					success: function(result) {
						// console.log(result);
						if (result.hits.length < 2){
							$("#pixaImg").attr("src","https://via.placeholder.com/400");
							$(".errMsg").removeClass("d-none");
						}
						else{
							$(".errMsg").addClass("d-none");
							arr = result.hits;
							rnd = Math.floor(Math.random() * arr.length);
							$("#pixaImg").attr("src",arr[rnd].largeImageURL);
						}
					},
					error: function(result){
						console.log("Error: " + result.errorMessage);
					} 
				});
			});
			$(".customQuote").off("keyup").on("keyup",function(){
				$(".qtPlace").html(this.value);
			});
			$(".customAuthor").off("keyup").on("keyup",function(){
				$(".author").html(this.value);
			});
			$(".quoteSearch").on("keyup",function(){
				var keyword = this.value;
				keyword = keyword.replace(" ", "|").toLowerCase();
				$.ajax({
					type: "GET",
					url: "https://api.quotable.io/quotes",
					data: {tags: keyword},
					success: function(result) {
						// console.log(result);
						if (result.results.length < 2){
							$(".qtPlace").addClass("text-danger").html("Something went wrong. Try terms like: 'Life', 'Love', 'happiness', 'technology', 'history' etc.");
						}
						else{
							arr = result.results;
							rnd = Math.floor(Math.random() * arr.length);
							$(".qtPlace").removeClass("text-danger").html(arr[rnd].content);
							$(".author").html("- "+arr[rnd].author);
						}
						
						
					},
					error: function(result){
						console.log("Error: " + result.errorMessage);
					} 
				});
			});

			$(".combineBtn").on("click",function(){
				var canvas = document.getElementById("canvas");
				var ctx = canvas.getContext("2d");
				var img = new Image();
				img.src = $("#pixaImg").attr("src");
				img.crossOrigin="anonymous";
				img.onload = function() {
					canvas.height = img.height / 2;
					canvas.width = img.width / 2;
					var hRatio = canvas.width  / img.width    ;
					var vRatio =  canvas.height / img.height  ;
					var ratio  = Math.min ( hRatio, vRatio );
					var centerShift_x = ( canvas.width - img.width*ratio ) / 2;
					var centerShift_y = ( canvas.height - img.height*ratio ) / 2;  
					ctx.drawImage(img, 0,0, img.width, img.height,centerShift_x,centerShift_y,img.width*ratio, img.height*ratio);


					ctx.fillStyle = '#000000b3';
					ctx.fillRect(0, 0, canvas.width, canvas.height);

					ctx.beginPath();
					ctx.fillStyle = '#fff';
					ctx.font = "20px arial";
					ctx.textAlign = "center";
					ctx.textBaseline = "middle";
					var arr = $(".qtPlace").html().split(" ");
					var arr2 = []
					var text = "";
					for (var i = 0; i <= arr.length; i++) {
						if (arr[i] != undefined){	
							text += arr[i] + " ";
						}
						if (i >= 7 && (i % 8) == 0 || i == arr.length){
							arr2.push(text);
							text = "";
						}
					}
					// console.log(arr2);

					for (var i = 0; i < arr2.length; i++) {
						x = 100 + (50 * (i + 1));
						ctx.fillText(arr2[i], (canvas.width / 2), x);
					}
					ctx.fillText($(".author").html(), (canvas.width - 150), (canvas.height - 100));
					ctx.closePath();
				};
			});

			$(".downloadBtn").on("click",function(){
				var canvas = document.getElementById("canvas");
				var imageData = canvas.toDataURL();
				var tmpLink = document.createElement( 'a' );  
				tmpLink.download = 'quoteImage.png'; 
				tmpLink.href = imageData;  

				document.body.appendChild( tmpLink );  
				tmpLink.click();  
				document.body.removeChild( tmpLink );
			})
		</script>
	</body>
	</html>
